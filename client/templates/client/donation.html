{% extends 'client/navbar.html' %}
{% load crispy_forms_tags %}

{% block content %}


<div class="container bg-white shadow-md p-5 form-layout">
    <h3>ðŸ’– Donate to Support Us</h3>
    <form id="donation-form">
        {% csrf_token %}
        <label>Enter amount (in THB):</label>
        <input type="number" id="amount" name="amount" class="form-control mb-3" min="10" required>
        <button type="submit" class="btn btn-success w-100">Donate Now</button>
    </form>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');
    document.getElementById('donation-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const amount = document.getElementById('amount').value;
        fetch("{% url 'create-donation-session' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: JSON.stringify({ amount: amount })
        })
        .then(res => res.json())
        .then(data => stripe.redirectToCheckout({ sessionId: data.sessionId }));
    });
</script>
{% endblock %}


